function loadImage(e,n,r){function a(){n.error&&n.error(r)}"function"==typeof n&&(n={success:n});var t=new Image;t.onload=function(){n.success(t,e,r)},t.onerror=a,/^novaskin:/.test(e)?fileSystem.get(e.replace("novaskin:",""),function(e){loadImage(e,n,r)}):/^dropbox:/.test(e)?window.URL?dropbox.readFile(e.replace("dropbox:",""),{blob:!0},function(e,t,i){e?a():loadImage(URL.createObjectURL(t),n,r)}):dropbox.makeUrl(entry.path,{download:!0},function(e,t){return e?a():void loadImage(t.url,n,r)}):e.indexOf("//local.novaskin.me")!=-1?(t.crossOrigin="anonymous",t.src=e):/^http|^\/\//.test(e)&&e.indexOf(location.host)==-1?(t.crossOrigin="anonymous",t.onerror=function(){t.onerror=a,t.src="/getimage?url="+encodeURIComponent(e)},t.src=e.replace("http://","//")):/data:/.test(e)?t.src=e.replace(/ /g,"+"):t.src=e.replace(/ /g,"+")}function loadSkin(e,n,r,a){function t(n){skin.canvas&&pushSkin({url:e,part:i}),i||clearLayers(),addLayer({image:n,filename:l,width:modelObject.texture.width,height:modelObject.texture.height}),hideActivity(),r&&r(),modelObject.model.afterLoad()}var i=n&&n.part||n;r=r||n&&n.success,a=a||n&&n.error;var l=n&&n.filename;n&&n.image?t(n.image):loadImage(e,{success:t,error:function(){hideActivity(),a&&a()}})}function loadUserSkin(e,n,r,a,t){loadSkin("http://skins.minecraft.net/MinecraftSkins/"+e+".png",n,r,a,t)}function yqlGetImageData(e,n,r,a){$.ajax({url:"http://query.yahooapis.com/v1/public/yql?format=json&q=select%20*%20from%20data.uri%20where%20url%3D%40url",data:{url:e},dataType:"jsonp",jsonp:"callback",jsonpCallback:"yqlCallback",cache:!0,error:r,timeout:5e3}),yqlCallback=function(t){try{if(t&&t.query&&t.query.results&&!t.query.results.error&&t.query.results.url){var i=new Image;i.onload=function(){n(i,e,a)},i.src=t.query.results.url}else r()}catch(l){r()}}}function yqlCallback(e){}function serverGetImageData(e,n,r,a){$.getImageData({server:"/getimagedata?callback=?",url:e.replace("https","http"),success:function(r){n(r,e,a)},error:r})}function loadImages(e,n,r){var a,t=0,i={},l={success:function(e,l,o){i[o]=e;var s=Math.round(100*(a-t)/a);r&&r(s,e,o),0==--t&&(n(i),hideActivity())},error:function(e,r){var a=e.replace("blocks/","");blockstextureslist[a]&&r.src!=blockstextureslist[a]?r.src=blockstextureslist[a]:0==--t&&(n(i),hideActivity())}};for(var o in e)o&&e[o]&&/png$/.test(o)&&++t&&loadImage(e[o],l,o);a=t,showActivity()}function Layer(e,n){return{type:e||"_empty",dye:n||"Ink_Sac"}}function Banner(e){this.layers=e&&$.extend(!0,[],e)||[Layer("base","Bone_Meal")]}function BannerEditor(e){this.addFirstBannerColorSelection(),this.showLayers(e)}function extractLayerDataFromTags(e){var n={};for(var r in PatternTags)n[PatternTags[r]]=r;var a={};for(var t in colors)a[colors[t].id]=t;var i=e.map(function(e){return e=e&&e.match(/([a-z]+)([0-9]+)/),e&&Layer(n[e[1]],a[e[2]])}).filter(function(e){return e});return i[0]&&(i[0].type="base"),i.length>0?i:null}function preloadImages(){for(var e in Recipes)preloadedImages[e]=new Image,preloadedImages[e].src="/images/banners/"+e+".png";preloadedImages.banner_base=new Image,preloadedImages.banner_base.src="/images/banners/banner_base.png"}function exploreSimilar(e,n){var r=$(".banner-container #banners-toggle .active .banner").toArray().map(function(e){return $(e).data("type")}),a=$(".banner-container #colors-toggle .active").toArray().map(function(e){return $(e).data("dye")}),t=[a[Math.floor(Math.random()*a.length)]];$(".banner-container #random-banners .banners .banner").not(n).each(function(){var n=new Banner(e),a=Math.floor(Math.random()*e.length),i=n.layers[a];a>0&&Math.random()>.5?i.type=r[Math.floor(Math.random()*r.length)]:i.dye=t[Math.floor(Math.random()*t.length)],n.makeBanner(this),$(this).data("layers",n.layers)})}function showBannerOnCollection(e){var n=$("<div>").addClass("banner").appendTo("#collection .banners").data("layers",e);new Banner(e).makeBanner(n),n.append('<button type="button" class="close pull-right">&times;</button>')}function storeCollection(){var e=$(".banner-container #collection .banner").toArray().map(function(e){return $(e).data("layers")});localStorage.setItem("collection",JSON.stringify(e))}!function(e){var n,r=e();e.fn.sortable=function(a){var t=String(a);return a=e.extend({connectWith:!1},a),this.each(function(){if(/^enable|disable|destroy$/.test(t)){var i=e(this).children(e(this).data("items")).attr("draggable","enable"==t);return void("destroy"==t&&i.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"))}var l,o,i=e(this).children(a.items),s=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');i.find(a.handle).mousedown(function(){l=!0}).mouseup(function(){l=!1}),e(this).data("items",a.items),r=r.add(s),a.connectWith&&e(a.connectWith).add(this).data("connectWith",a.connectWith),i.attr("draggable","true").on("dragstart.h5s",function(r){if(a.handle&&!l)return!1;l=!1;var t=r.originalEvent.dataTransfer;t.effectAllowed="move",t.setData("Text","dummy"),o=(n=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){n.removeClass("sortable-dragging").show(),r.detach(),o!=n.index()&&i.parent().trigger("sortupdate",{item:n}),n=null}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,s]).on("dragover.h5s dragenter.h5s drop.h5s",function(t){return!i.is(n)&&a.connectWith!==e(n).parent().data("connectWith")||("drop"==t.type?(t.stopPropagation(),r.filter(":visible").after(n),!1):(t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="move",i.is(this)?(a.forcePlaceholderSize&&s.height(n.outerHeight()),n.hide(),e(this)[s.index()<e(this).index()?"after":"before"](s),r.not(s).detach()):r.is(this)||e(this).children(a.items).length||(r.detach(),e(this).append(s)),!1))})})}}(jQuery);var ImageUtils={loadImage:function(e,n,r,a){loadImage(e,{success:n,error:r},a)},loadGifFrames:function(e,n){var r=new FileReader;r.onload=function(e){var r=new SuperGif({gif:e.target.result});r.load(function(){for(var a=r.get_canvas(),t=0;t<r.get_length();t++)r.move_to(t),n(e.target.file.name,t,a)})},r.file=e,r.readAsBinaryString(e)},uploadImage:function(e,n,r,a){ImageUtils.uploadImageToStorage(e,n,r,a)},uploadImageWithImgurV2:function(e,n,r,a){console.error("obsolete imgur upload")},uploadImageToStorage:function(e,n,r,a){$.post("/uploadimage",{image:ImageUtils.toDataURL(e).split(",")[1],caption:a,title:r,type:"base64",_method:"POST"},function(e,r,a){e?(e=e.responseText?JSON.parse(e):e,n(e.data.link)):n("")},"json")},uploadTemporaryImage:function(e,n){$.post("/tmpimage",{image:ImageUtils.toDataURL(e).split(",")[1],type:"base64",_method:"POST"},function(e,r,a){e?(e=e.responseText?JSON.parse(e):e,n(e.data.link)):n("")},"json")},nearestNeighborImageResize:function(e,n){var r=document.createElement("canvas"),a=r.getContext("2d");if(r.width=e.width*n,r.height=e.height*n,a.imageSmoothingEnabled=!1,a.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),isIE){var t=document.createElement("canvas"),i=t.getContext("2d");i.drawImage(e,0,0);for(var l=i.getImageData(0,0,e.width,e.height).data,o=0;o<e.width;++o)for(var s=0;s<e.height;++s){var d=4*(s*e.width+o),g=l[d],h=l[d+1],c=l[d+2],u=l[d+3];a.fillStyle="rgba("+g+","+h+","+c+","+u/255+")",a.fillRect(o*n,s*n,n,n)}}return r},crop16:function(e,n,r){var a=document.createElement("canvas"),t=a.getContext("2d"),i=new Image;a.width=16,a.height=16,i.onload=function(){t.drawImage(i,0,0,i.width,Math.min(i.width,i.height),0,0,a.width,a.height),n(a.toDataURL(),r)},i.src=e},resize:function(e,n,r){var a=document.createElement("canvas"),t=a.getContext("2d"),i=n/r;return a.width=n,a.height=r,t.drawImage(e,0,0,e.width,e.width/i,0,0,a.width,a.height),a},toDataURL:function(e,n){if("string"==typeof e)return e;if(e.toDataURL)return e.toDataURL(n);var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var a=r.getContext("2d");return a.drawImage(e,0,0),r.toDataURL(n)}},masks=["_empty","skull","small_stripes","square_bottom_left","square_bottom_right","square_top_left","square_top_right","straight_cross","stripe_bottom","stripe_center","stripe_downleft","stripe_downright","stripe_left","stripe_middle","stripe_right","stripe_top","triangle_bottom","triangle_top","triangles_bottom","triangles_top","border","bricks","circle","creeper","cross","curly_border","diagonal_left","diagonal_right","flower","gradient","half_horizontal","half_vertical","mojang","rhombus","diagonal_up_left","diagonal_up_right","gradient_up","half_horizontal_bottom","half_vertical_right"].sort(),colors={Ink_Sac:{color:"#191919",name:"Black",id:0},Rose_Red:{color:"#993333",name:"Red",id:1},Cactus_Green:{color:"#667F33",name:"Green",id:2},Cocoa_Beans:{color:"#664C33",name:"Brown",id:3},Lapis_Lazuli:{color:"#334CB2",name:"Blue",id:4},Purple_Dye:{color:"#7F3FB2",name:"Purple",id:5},Cyan_Dye:{color:"#4C7F99",name:"Cyan",id:6},Light_Gray_Dye:{color:"#999999",name:"Light_Gray",id:7},Gray_Dye:{color:"#4C4C4C",name:"Gray",id:8},Pink_Dye:{color:"#F27FA5",name:"Pink",id:9},Lime_Dye:{color:"#7FCC19",name:"Lime",id:10},Dandelion_Yellow:{color:"#E5E533",name:"Yellow",id:11},Light_Blue_Dye:{color:"#6699D8",name:"Light_Blue",id:12},Magenta_Dye:{color:"#B24CD8",name:"Magenta",id:13},Orange_Dye:{color:"#D87F33",name:"Orange",id:14},Bone_Meal:{color:"#FFFFFF",name:"White",id:15}},PatternTags={base:"b",square_bottom_left:"bl",square_bottom_right:"br",square_top_left:"tl",square_top_right:"tr",stripe_bottom:"bs",stripe_top:"ts",stripe_left:"ls",stripe_right:"rs",stripe_center:"cs",stripe_middle:"ms",stripe_downright:"drs",stripe_downleft:"dls",small_stripes:"ss",cross:"cr",straight_cross:"sc",triangle_bottom:"bt",triangle_top:"tt",triangles_bottom:"bts",triangles_top:"tts",diagonal_left:"ld",diagonal_right:"rd",circle:"mc",rhombus:"mr",half_vertical:"vh",half_horizontal:"hh",border:"bo",curly_border:"cbo",creeper:"cre",gradient:"gra",bricks:"bri",skull:"sku",flower:"flo",mojang:"moj",diagonal_up_left:"lud",diagonal_up_right:"rd",gradient_up:"gru",half_horizontal_bottom:"hhb",half_vertical_right:"vhr"},Recipes={skull:"Grid_Wither_Skeleton_Skull",small_stripes:["dye",0,"dye","dye",0,"dye",0,"banner",0],square_bottom_left:[0,0,0,0,"banner",0,"dye",0,0],square_bottom_right:[0,0,0,0,"banner",0,0,0,"dye"],square_top_left:["dye",0,0,0,"banner",0,0,0,0],square_top_right:[0,0,"dye",0,"banner",0,0,0,0],straight_cross:["banner","dye",0,"dye","dye","dye",0,"dye",0],stripe_bottom:[0,0,0,0,"banner",0,"dye","dye","dye"],stripe_center:[0,"dye",0,"banner","dye",0,0,"dye",0],stripe_downleft:[0,0,"dye",0,"dye",0,"dye","banner",0],stripe_downright:["dye",0,0,0,"dye",0,0,"banner","dye"],stripe_left:["dye",0,0,"dye",0,0,"dye","banner",0],stripe_middle:[0,0,0,"dye","dye","dye",0,"banner",0],stripe_right:[0,0,"dye",0,0,"dye",0,"banner","dye"],stripe_top:["dye","dye","dye",0,0,0,0,"banner",0],triangle_bottom:[0,0,0,0,"dye",0,"dye","banner","dye"],triangle_top:["dye",0,"dye",0,"dye",0,0,"banner",0],triangles_bottom:[0,0,0,"dye","banner","dye",0,"dye",0],triangles_top:[0,"dye",0,"dye","banner","dye",0,0,0],border:["dye","dye","dye","dye","banner","dye","dye","dye","dye"],bricks:"Grid_Bricks",circle:[0,0,0,0,"dye",0,0,"banner",0],creeper:"Grid_Creeper_Head",cross:["dye",0,"dye",0,"dye",0,"dye","banner","dye"],curly_border:"Grid_Vines",diagonal_left:["dye","dye",0,"dye",0,0,0,"banner",0],diagonal_right:[0,"dye","dye",0,0,"dye",0,"banner",0],flower:"Grid_Oxeye_Daisy",gradient:["dye","banner","dye",0,"dye",0,0,"dye",0],half_horizontal:["dye","dye","dye","dye","dye","dye",0,"banner",0],half_vertical:["dye","dye",0,"dye","dye",0,"dye","dye","banner"],mojang:"Grid_Golden_Apple",rhombus:[0,"dye",0,"dye","banner","dye",0,"dye",0],base:["wool","wool","wool","wool","wool","wool",0,"stick",0],diagonal_up_left:[0,0,0,"dye","banner",0,"dye","dye",0],diagonal_up_right:[0,0,0,0,"banner","dye",0,"dye","dye"],gradient_up:[0,"dye",0,0,"dye",0,"dye","banner","dye"],half_horizontal_bottom:[0,"banner",0,"dye","dye","dye","dye","dye","dye"],half_vertical_right:[0,"dye","dye",0,"dye","dye","baner","dye","dye"]},lang={_empty:{name:"Empty"},base:{black:"Black Banner",red:"Red Banner",green:"Green Banner",brown:"Brown Banner",blue:"Blue Banner",purple:"Purple Banner",cyan:"Cyan Banner",light_gray:"Light Gray Banner",gray:"Gray Banner",pink:"Pink Banner",lime:"Lime Banner",yellow:"Yellow Banner",light_blue:"Light Blue Banner",magenta:"Magenta Banner",orange:"Orange Banner",white:"White Banner",name:"Banner"},square_bottom_left:{black:"Black Base Dexter Canton",red:"Red Base Dexter Canton",green:"Green Base Dexter Canton",brown:"Brown Base Dexter Canton",blue:"Blue Base Dexter Canton",purple:"Purple Base Dexter Canton",cyan:"Cyan Base Dexter Canton",light_gray:"Light Gray Base Dexter Canton",gray:"Gray Base Dexter Canton",pink:"Pink Base Dexter Canton",lime:"Lime Base Dexter Canton",yellow:"Yellow Base Dexter Canton",light_blue:"Light Blue Base Dexter Canton",magenta:"Magenta Base Dexter Canton",orange:"Orange Base Dexter Canton",white:"White Base Dexter Canton",name:"Base Dexter Canton"},square_bottom_right:{black:"Black Base Sinister Canton",red:"Red Base Sinister Canton",green:"Green Base Sinister Canton",brown:"Brown Base Sinister Canton",blue:"Blue Base Sinister Canton",purple:"Purple Base Sinister Canton",cyan:"Cyan Base Sinister Canton",light_gray:"Light Gray Base Sinister Canton",gray:"Gray Base Sinister Canton",pink:"Pink Base Sinister Canton",lime:"Lime Base Sinister Canton",yellow:"Yellow Base Sinister Canton",light_blue:"Light Blue Base Sinister Canton",magenta:"Magenta Base Sinister Canton",orange:"Orange Base Sinister Canton",white:"White Base Sinister Canton",name:"Base Sinister Canton"},square_top_left:{black:"Black Chief Dexter Canton",red:"Red Chief Dexter Canton",green:"Green Chief Dexter Canton",brown:"Brown Chief Dexter Canton",blue:"Blue Chief Dexter Canton",purple:"Purple Chief Dexter Canton",cyan:"Cyan Chief Dexter Canton",light_gray:"Light Gray Chief Dexter Canton",gray:"Gray Chief Dexter Canton",pink:"Pink Chief Dexter Canton",lime:"Lime Chief Dexter Canton",yellow:"Yellow Chief Dexter Canton",light_blue:"Light Blue Chief Dexter Canton",magenta:"Magenta Chief Dexter Canton",orange:"Orange Chief Dexter Canton",white:"White Chief Dexter Canton",name:"Chief Dexter Canton"},square_top_right:{black:"Black Chief Sinister Canton",red:"Red Chief Sinister Canton",green:"Green Chief Sinister Canton",brown:"Brown Chief Sinister Canton",blue:"Blue Chief Sinister Canton",purple:"Purple Chief Sinister Canton",cyan:"Cyan Chief Sinister Canton",light_gray:"Light Gray Chief Sinister Canton",gray:"Gray Chief Sinister Canton",pink:"Pink Chief Sinister Canton",lime:"Lime Chief Sinister Canton",yellow:"Yellow Chief Sinister Canton",light_blue:"Light Blue Chief Sinister Canton",magenta:"Magenta Chief Sinister Canton",orange:"Orange Chief Sinister Canton",white:"White Chief Sinister Canton",name:"Chief Sinister Canton"},stripe_bottom:{black:"Black Base Fess",red:"Red Base Fess",green:"Green Base Fess",brown:"Brown Base Fess",blue:"Blue Base Fess",purple:"Purple Base Fess",cyan:"Cyan Base Fess",light_gray:"Light Gray Base Fess",gray:"Gray Base Fess",pink:"Pink Base Fess",lime:"Lime Base Fess",yellow:"Yellow Base Fess",light_blue:"Light Blue Base Fess",magenta:"Magenta Base Fess",orange:"Orange Base Fess",white:"White Base Fess",name:"Base Fess"},stripe_top:{black:"Black Chief Fess",red:"Red Chief Fess",green:"Green Chief Fess",brown:"Brown Chief Fess",blue:"Blue Chief Fess",purple:"Purple Chief Fess",cyan:"Cyan Chief Fess",light_gray:"Light Gray Chief Fess",gray:"Gray Chief Fess",pink:"Pink Chief Fess",lime:"Lime Chief Fess",yellow:"Yellow Chief Fess",light_blue:"Light Blue Chief Fess",magenta:"Magenta Chief Fess",orange:"Orange Chief Fess",white:"White Chief Fess",name:"Chief Fess"},stripe_left:{black:"Black Pale Dexter",red:"Red Pale Dexter",green:"Green Pale Dexter",brown:"Brown Pale Dexter",blue:"Blue Pale Dexter",purple:"Purple Pale Dexter",cyan:"Cyan Pale Dexter",light_gray:"Light Gray Pale Dexter",gray:"Gray Pale Dexter",pink:"Pink Pale Dexter",lime:"Lime Pale Dexter",yellow:"Yellow Pale Dexter",light_blue:"Light Blue Pale Dexter",magenta:"Magenta Pale Dexter",orange:"Orange Pale Dexter",white:"White Pale Dexter",name:"Pale Dexter"},stripe_right:{black:"Black Pale Sinister",red:"Red Pale Sinister",green:"Green Pale Sinister",brown:"Brown Pale Sinister",blue:"Blue Pale Sinister",purple:"Purple Pale Sinister",cyan:"Cyan Pale Sinister",light_gray:"Light Gray Pale Sinister",gray:"Gray Pale Sinister",pink:"Pink Pale Sinister",lime:"Lime Pale Sinister",yellow:"Yellow Pale Sinister",light_blue:"Light Blue Pale Sinister",magenta:"Magenta Pale Sinister",orange:"Orange Pale Sinister",white:"White Pale Sinister",name:"Pale Sinister"},stripe_center:{black:"Black Pale",red:"Red Pale",green:"Green Pale",brown:"Brown Pale",blue:"Blue Pale",purple:"Purple Pale",cyan:"Cyan Pale",light_gray:"Light Gray Pale",gray:"Gray Pale",pink:"Pink Pale",lime:"Lime Pale",yellow:"Yellow Pale",light_blue:"Light Blue Pale",magenta:"Magenta Pale",orange:"Orange Pale",white:"White Pale",name:"Pale"},stripe_middle:{black:"Black Fess",red:"Red Fess",green:"Green Fess",brown:"Brown Fess",blue:"Blue Fess",purple:"Purple Fess",cyan:"Cyan Fess",light_gray:"Light Gray Fess",gray:"Gray Fess",pink:"Pink Fess",lime:"Lime Fess",yellow:"Yellow Fess",light_blue:"Light Blue Fess",magenta:"Magenta Fess",orange:"Orange Fess",white:"White Fess",name:"Fess"},stripe_downright:{black:"Black Bend",red:"Red Bend",green:"Green Bend",brown:"Brown Bend",blue:"Blue Bend",purple:"Purple Bend",cyan:"Cyan Bend",light_gray:"Light Gray Bend",gray:"Gray Bend",pink:"Pink Bend",lime:"Lime Bend",yellow:"Yellow Bend",light_blue:"Light Blue Bend",magenta:"Magenta Bend",orange:"Orange Bend",white:"White Bend",name:"Bend"},stripe_downleft:{black:"Black Bend Sinister",red:"Red Bend Sinister",green:"Green Bend Sinister",brown:"Brown Bend Sinister",blue:"Blue Bend Sinister",purple:"Purple Bend Sinister",cyan:"Cyan Bend Sinister",light_gray:"Light Gray Bend Sinister",gray:"Gray Bend Sinister",pink:"Pink Bend Sinister",lime:"Lime Bend Sinister",yellow:"Yellow Bend Sinister",light_blue:"Light Blue Bend Sinister",magenta:"Magenta Bend Sinister",orange:"Orange Bend Sinister",white:"White Bend Sinister",name:"Bend Sinister"},small_stripes:{black:"Black Paly",red:"Red Paly",green:"Green Paly",brown:"Brown Paly",blue:"Blue Paly",purple:"Purple Paly",cyan:"Cyan Paly",light_gray:"Light Gray Paly",gray:"Gray Paly",pink:"Pink Paly",lime:"Lime Paly",yellow:"Yellow Paly",light_blue:"Light Blue Paly",magenta:"Magenta Paly",orange:"Orange Paly",white:"White Paly",name:"Paly"},cross:{black:"Black Saltire",red:"Red Saltire",green:"Green Saltire",brown:"Brown Saltire",blue:"Blue Saltire",purple:"Purple Saltire",cyan:"Cyan Saltire",light_gray:"Light Gray Saltire",gray:"Gray Saltire",pink:"Pink Saltire",lime:"Lime Saltire",yellow:"Yellow Saltire",light_blue:"Light Blue Saltire",magenta:"Magenta Saltire",orange:"Orange Saltire",white:"White Saltire",name:"Saltire"},triangle_bottom:{black:"Black Chevron",red:"Red Chevron",green:"Green Chevron",brown:"Brown Chevron",blue:"Blue Chevron",purple:"Purple Chevron",cyan:"Cyan Chevron",light_gray:"Light Gray Chevron",gray:"Gray Chevron",pink:"Pink Chevron",lime:"Lime Chevron",yellow:"Yellow Chevron",light_blue:"Light Blue Chevron",magenta:"Magenta Chevron",orange:"Orange Chevron",white:"White Chevron",name:"Chevron"},triangle_top:{black:"Black Inverted Chevron",red:"Red Inverted Chevron",green:"Green Inverted Chevron",brown:"Brown Inverted Chevron",blue:"Blue Inverted Chevron",purple:"Purple Inverted Chevron",cyan:"Cyan Inverted Chevron",light_gray:"Light Gray Inverted Chevron",gray:"Gray Inverted Chevron",pink:"Pink Inverted Chevron",lime:"Lime Inverted Chevron",yellow:"Yellow Inverted Chevron",light_blue:"Light Blue Inverted Chevron",magenta:"Magenta Inverted Chevron",orange:"Orange Inverted Chevron",white:"White Inverted Chevron",name:"Inverted Chevron"},triangles_bottom:{black:"Black Base Indented",red:"Red Base Indented",green:"Green Base Indented",brown:"Brown Base Indented",blue:"Blue Base Indented",purple:"Purple Base Indented",cyan:"Cyan Base Indented",light_gray:"Light Gray Base Indented",gray:"Gray Base Indented",pink:"Pink Base Indented",lime:"Lime Base Indented",yellow:"Yellow Base Indented",light_blue:"Light Blue Base Indented",magenta:"Magenta Base Indented",orange:"Orange Base Indented",white:"White Base Indented",name:"Base Indented"},triangles_top:{black:"Black Chief Indented",red:"Red Chief Indented",green:"Green Chief Indented",brown:"Brown Chief Indented",blue:"Blue Chief Indented",purple:"Purple Chief Indented",cyan:"Cyan Chief Indented",light_gray:"Light Gray Chief Indented",gray:"Gray Chief Indented",pink:"Pink Chief Indented",lime:"Lime Chief Indented",yellow:"Yellow Chief Indented",light_blue:"Light Blue Chief Indented",magenta:"Magenta Chief Indented",orange:"Orange Chief Indented",white:"White Chief Indented",name:"Chief Indented"},diagonal_left:{black:"Black Per Bend Sinister",red:"Red Per Bend Sinister",green:"Green Per Bend Sinister",brown:"Brown Per Bend Sinister",blue:"Blue Per Bend Sinister",purple:"Purple Per Bend Sinister",cyan:"Cyan Per Bend Sinister",light_gray:"Light Gray Per Bend Sinister",gray:"Gray Per Bend Sinister",pink:"Pink Per Bend Sinister",lime:"Lime Per Bend Sinister",yellow:"Yellow Per Bend Sinister",light_blue:"Light Blue Per Bend Sinister",magenta:"Magenta Per Bend Sinister",orange:"Orange Per Bend Sinister",white:"White Per Bend Sinister",name:"Per Bend Sinister"},diagonal_right:{black:"Black Per Bend",red:"Red Per Bend",green:"Green Per Bend",brown:"Brown Per Bend",blue:"Blue Per Bend",purple:"Purple Per Bend",cyan:"Cyan Per Bend",light_gray:"Light Gray Per Bend",gray:"Gray Per Bend",pink:"Pink Per Bend",lime:"Lime Per Bend",yellow:"Yellow Per Bend",light_blue:"Light Blue Per Bend",magenta:"Magenta Per Bend",orange:"Orange Per Bend",white:"White Per Bend",name:"Per Bend"},diagonal_up_left:{black:"Black Per Bend Inverted",red:"Red Per Bend Inverted",green:"Green Per Bend Inverted",brown:"Brown Per Bend Inverted",blue:"Blue Per Bend Inverted",purple:"Purple Per Bend Inverted",cyan:"Cyan Per Bend Inverted",light_gray:"Light Gray Per Bend Inverted",gray:"Gray Per Bend Inverted",pink:"Pink Per Bend Inverted",lime:"Lime Per Bend Inverted",yellow:"Yellow Per Bend Inverted",light_blue:"Light Blue Per Bend Inverted",magenta:"Magenta Per Bend Inverted",orange:"Orange Per Bend Inverted",white:"White Per Bend Inverted",name:"Per Bend Inverted"},diagonal_up_right:{black:"Black Per Bend Sinister Inverted",red:"Red Per Bend Sinister Inverted",green:"Green Per Bend Sinister Inverted",brown:"Brown Per Bend Sinister Inverted",blue:"Blue Per Bend Sinister Inverted",purple:"Purple Per Bend Sinister Inverted",cyan:"Cyan Per Bend Sinister Inverted",light_gray:"Light Gray Per Bend Sinister Inverted",gray:"Gray Per Bend Sinister Inverted",pink:"Pink Per Bend Sinister Inverted",lime:"Lime Per Bend Sinister Inverted",yellow:"Yellow Per Bend Sinister Inverted",light_blue:"Light Blue Per Bend Sinister Inverted",magenta:"Magenta Per Bend Sinister Inverted",orange:"Orange Per Bend Sinister Inverted",white:"White Per Bend Sinister Inverted",name:"Per Bend Sinister Inverted"},circle:{black:"Black Roundel",red:"Red Roundel",green:"Green Roundel",brown:"Brown Roundel",blue:"Blue Roundel",purple:"Purple Roundel",cyan:"Cyan Roundel",light_gray:"Light Gray Roundel",gray:"Gray Roundel",pink:"Pink Roundel",lime:"Lime Roundel",yellow:"Yellow Roundel",light_blue:"Light Blue Roundel",magenta:"Magenta Roundel",orange:"Orange Roundel",white:"White Roundel",name:"Roundel"},rhombus:{black:"Black Lozenge",red:"Red Lozenge",green:"Green Lozenge",brown:"Brown Lozenge",blue:"Blue Lozenge",purple:"Purple Lozenge",cyan:"Cyan Lozenge",light_gray:"Light Gray Lozenge",gray:"Gray Lozenge",pink:"Pink Lozenge",lime:"Lime Lozenge",yellow:"Yellow Lozenge",light_blue:"Light Blue Lozenge",magenta:"Magenta Lozenge",orange:"Orange Lozenge",white:"White Lozenge",name:"Lozenge"},half_vertical:{black:"Black Per Pale",red:"Red Per Pale",green:"Green Per Pale",brown:"Brown Per Pale",blue:"Blue Per Pale",purple:"Purple Per Pale",cyan:"Cyan Per Pale",light_gray:"Light Gray Per Pale",gray:"Gray Per Pale",pink:"Pink Per Pale",lime:"Lime Per Pale",yellow:"Yellow Per Pale",light_blue:"Light Blue Per Pale",magenta:"Magenta Per Pale",orange:"Orange Per Pale",white:"White Per Pale",name:"Per Pale"},half_horizontal:{black:"Black Per Fess",red:"Red Per Fess",green:"Green Per Fess",brown:"Brown Per Fess",blue:"Blue Per Fess",purple:"Purple Per Fess",cyan:"Cyan Per Fess",light_gray:"Light Gray Per Fess",gray:"Gray Per Fess",pink:"Pink Per Fess",lime:"Lime Per Fess",yellow:"Yellow Per Fess",light_blue:"Light Blue Per Fess",magenta:"Magenta Per Fess",orange:"Orange Per Fess",white:"White Per Fess",name:"Per Fess"},half_vertical_right:{black:"Black Per Pale Inverted",red:"Red Per Pale Inverted",green:"Green Per Pale Inverted",brown:"Brown Per Pale Inverted",blue:"Blue Per Pale Inverted",purple:"Purple Per Pale Inverted",cyan:"Cyan Per Pale Inverted",light_gray:"Light Gray Per Pale Inverted",gray:"Gray Per Pale Inverted",pink:"Pink Per Pale Inverted",lime:"Lime Per Pale Inverted",yellow:"Yellow Per Pale Inverted",light_blue:"Light Blue Per Pale Inverted",magenta:"Magenta Per Pale Inverted",orange:"Orange Per Pale Inverted",white:"White Per Pale Inverted",name:"Per Pale Inverted"},half_horizontal_bottom:{black:"Black Per Fess Inverted",red:"Red Per Fess Inverted",green:"Green Per Fess Inverted",brown:"Brown Per Fess Inverted",blue:"Blue Per Fess Inverted",purple:"Purple Per Fess Inverted",cyan:"Cyan Per Fess Inverted",light_gray:"Light Gray Per Fess Inverted",gray:"Gray Per Fess Inverted",pink:"Pink Per Fess Inverted",lime:"Lime Per Fess Inverted",yellow:"Yellow Per Fess Inverted",light_blue:"Light Blue Per Fess Inverted",magenta:"Magenta Per Fess Inverted",orange:"Orange Per Fess Inverted",white:"White Per Fess Inverted",name:"Per Fess Inverted"},creeper:{black:"Black Creeper Charge",red:"Red Creeper Charge",green:"Green Creeper Charge",brown:"Brown Creeper Charge",blue:"Blue Creeper Charge",purple:"Purple Creeper Charge",cyan:"Cyan Creeper Charge",light_gray:"Light Gray Creeper Charge",gray:"Gray Creeper Charge",pink:"Pink Creeper Charge",lime:"Lime Creeper Charge",yellow:"Yellow Creeper Charge",light_blue:"Light Blue Creeper Charge",magenta:"Magenta Creeper Charge",orange:"Orange Creeper Charge",white:"White Creeper Charge",name:"Creeper Charge"},bricks:{black:"Black Field Masoned",red:"Red Field Masoned",green:"Green Field Masoned",brown:"Brown Field Masoned",blue:"Blue Field Masoned",purple:"Purple Field Masoned",cyan:"Cyan Field Masoned",light_gray:"Light Gray Field Masoned",gray:"Gray Field Masoned",pink:"Pink Field Masoned",lime:"Lime Field Masoned",yellow:"Yellow Field Masoned",light_blue:"Light Blue Field Masoned",magenta:"Magenta Field Masoned",orange:"Orange Field Masoned",white:"White Field Masoned",name:"Field Masoned"},gradient:{black:"Black Gradient",red:"Red Gradient",green:"Green Gradient",brown:"Brown Gradient",blue:"Blue Gradient",purple:"Purple Gradient",cyan:"Cyan Gradient",light_gray:"Light Gray Gradient",gray:"Gray Gradient",pink:"Pink Gradient",lime:"Lime Gradient",yellow:"Yellow Gradient",light_blue:"Light Blue Gradient",magenta:"Magenta Gradient",orange:"Orange Gradient",white:"White Gradient",name:"Gradient"},gradient_up:{black:"Black Base Gradient",red:"Red Base Gradient",green:"Green Base Gradient",brown:"Brown Base Gradient",blue:"Blue Base Gradient",purple:"Purple Base Gradient",cyan:"Cyan Base Gradient",light_gray:"Light Gray Base Gradient",gray:"Gray Base Gradient",pink:"Pink Base Gradient",lime:"Lime Base Gradient",yellow:"Yellow Base Gradient",light_blue:"Light Blue Base Gradient",magenta:"Magenta Base Gradient",orange:"Orange Base Gradient",white:"White Base Gradient",name:"Base Gradient"},skull:{black:"Black Skull Charge",red:"Red Skull Charge",green:"Green Skull Charge",brown:"Brown Skull Charge",blue:"Blue Skull Charge",purple:"Purple Skull Charge",cyan:"Cyan Skull Charge",light_gray:"Light Gray Skull Charge",gray:"Gray Skull Charge",pink:"Pink Skull Charge",lime:"Lime Skull Charge",yellow:"Yellow Skull Charge",light_blue:"Light Blue Skull Charge",magenta:"Magenta Skull Charge",orange:"Orange Skull Charge",white:"White Skull Charge",name:"Skull Charge"},flower:{black:"Black Flower Charge",red:"Red Flower Charge",green:"Green Flower Charge",brown:"Brown Flower Charge",blue:"Blue Flower Charge",purple:"Purple Flower Charge",cyan:"Cyan Flower Charge",light_gray:"Light Gray Flower Charge",gray:"Gray Flower Charge",pink:"Pink Flower Charge",lime:"Lime Flower Charge",yellow:"Yellow Flower Charge",light_blue:"Light Blue Flower Charge",magenta:"Magenta Flower Charge",orange:"Orange Flower Charge",white:"White Flower Charge",name:"Flower Charge"},border:{black:"Black Bordure",red:"Red Bordure",green:"Green Bordure",brown:"Brown Bordure",blue:"Blue Bordure",purple:"Purple Bordure",cyan:"Cyan Bordure",light_gray:"Light Gray Bordure",gray:"Gray Bordure",pink:"Pink Bordure",lime:"Lime Bordure",yellow:"Yellow Bordure",light_blue:"Light Blue Bordure",magenta:"Magenta Bordure",orange:"Orange Bordure",white:"White Bordure",name:"Bordure"},curly_border:{black:"Black Bordure Indented",red:"Red Bordure Indented",green:"Green Bordure Indented",brown:"Brown Bordure Indented",blue:"Blue Bordure Indented",purple:"Purple Bordure Indented",cyan:"Cyan Bordure Indented",light_gray:"Light Gray Bordure Indented",gray:"Gray Bordure Indented",pink:"Pink Bordure Indented",lime:"Lime Bordure Indented",yellow:"Yellow Bordure Indented",light_blue:"Light Blue Bordure Indented",magenta:"Magenta Bordure Indented",orange:"Orange Bordure Indented",white:"White Bordure Indented",name:"Bordure Indented"},mojang:{black:"Black Thing",red:"Red Thing",green:"Green Thing",brown:"Brown Thing",blue:"Blue Thing",purple:"Purple Thing",cyan:"Cyan Thing",light_gray:"Light Gray Thing",gray:"Gray Thing",pink:"Pink Thing",lime:"Lime Thing",yellow:"Yellow Thing",light_blue:"Light Blue Thing",magenta:"Magenta Thing",orange:"Orange Thing",white:"White Thing",name:"Thing"},straight_cross:{black:"Black Cross",red:"Red Cross",green:"Green Cross",brown:"Brown Cross",blue:"Blue Cross",purple:"Purple Cross",cyan:"Cyan Cross",light_gray:"Light Gray Cross",gray:"Gray Cross",pink:"Pink Cross",lime:"Lime Cross",yellow:"Yellow Cross",light_blue:"Light Blue Cross",magenta:"Magenta Cross",orange:"Orange Cross",white:"White Cross",name:"Cross"}},preloadedImages={};Banner.prototype={addLayer:function(){var e=Layer("_empty");return this.layers.push(e),e},usedLayers:function(){return this.layers.filter(function(e){return"_empty"!=e.type})},makeBanner:function(e){$(e).empty(),this.layers.forEach(function(n){var r=n.overrideType||n.type,a=n.overrideColor||colors[n.dye].color,t="url('/images/banners/"+r+".png')",i='url("#'+r+'-mask")';$("<div>").css({"-webkit-mask-image":t,mask:i,"background-color":a}).appendTo(e)})},cut:function(e){return new Banner(this.layers.slice(0,e+1))},overrideType:function(e){var n=this.layers.pop();return n.overrideType=e,this.layers.push(n),this},getResources:function(){function e(){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=256,e.height=256,{canvas:e,ctx:n}}var n=e();n.ctx.drawImage(preloadedImages.banner_base,0,0),this.layers.forEach(function(r){var a=r.overrideType||r.type,t=r.overrideColor||colors[r.dye].color,i=preloadedImages[a],r=e();i&&r.ctx.drawImage(i,0,0),r.ctx.globalCompositeOperation="source-in",r.ctx.fillStyle=t,r.ctx.fillRect(0,0,168,164),n.ctx.drawImage(r.canvas,0,0)});var r=e();return r.canvas.width=80,r.canvas.height=160,r.ctx.drawImage(n.canvas,4,4,80,160,0,0,80,160),{texture:n.canvas,screenshot:r.canvas}}},BannerEditor.prototype={updatePreview:function(){this.previewBanner.makeBanner(".preview .banner"),
$(".banner-container .recipe").empty().append(this.previewBanner.usedLayers().slice(0,7).map(function(e){return this.craftingTable(Recipes[e.type],e.dye,this.tag(e))},this))},ntb:function(e){return{BlockEntityTag:{Patterns:this.previewBanner.layers.filter(function(n){return!e||!/_empty|base/.test(n.type)}).map(function(e){return{Color:colors[e.dye].id,Pattern:PatternTags[e.type]}})}}},layerList:function(){return this.previewBanner.usedLayers().map(function(e){return PatternTags[e.type]+colors[e.dye].id}).join(",")},tag:function(e){return lang[e.type][colors[e.dye].name.toLocaleLowerCase()].replace(/\s/g,"-").toLocaleLowerCase()},tags:function(){return this.previewBanner.usedLayers().map(this.tag).join(",")},command:function(){var e=this.ntb(!0);return"/give @p minecraft:banner 1 "+colors[this.previewBanner.layers[0].dye].id+" "+JSON.stringify(e).replace(/"/g,"")},updateBanners:function(){this.updatePreview(),this.updateLayerPanels(),this.updateUrl()},updateUrl:function(){$(document.body).hasClass("banner-container")&&(window.location.hash=this.layerList()),$(".banner-container #shareurl").val(window.location.href),$(".banner-container #givecommand").text(this.command())},updateLayerPanels:function(){var e=this;$(".banner-container .banner.active").removeClass("active"),$(".banner-container #banner-layers .panel").each(function(n){var r=e.previewBanner.layers[n],a=r.type,t="_empty"==a?"Empty":r.dye;$(this).data("layer",r),0==n&&(t=colors[t].name+"_Wool");var i='<img src="/images/banners/Grid_'+t+'.png">';if($(this).find(".panel-title .title").html(i+" Layer "+n+("_empty"==a?"":" - "+lang[r.type][colors[r.dye].name.toLocaleLowerCase()])),n>0){var l=e.previewBanner.cut(n);e.updatePanelBanners(this,l),$(this).find(".banner[data-type="+r.type+"]").addClass("active")}})},updatePanelBanners:function(e,n){$(e).find(".banner").each(function(){var e=$(this).data("type");n.overrideType(e).makeBanner(this)}),n.overrideType(!1)},showLayers:function(e){this.previewBanner=new Banner(e),$(".banner-container #banner-layers .editable-panel").remove();for(var n=1;n<this.previewBanner.layers.length;n++)this.addLayerPanel(this.previewBanner.layers[n]);this.updateBanners()},addLayerPanel:function(e){var n="";for(var r in colors)n+='<div style="background-color: '+colors[r].color+'" data-dye="'+r+'"><img src="/images/banners/Grid_'+r+'.png"></div>';var a=1e4*Math.random()|0;e||(e=this.previewBanner.addLayer());var t=$('<div class="panel panel-default editable-panel"><div class="panel-heading"><span class="handle pull-left glyphicon glyphicon-align-justify"></span><a data-toggle="collapse" data-parent="#banner-layers" href="#layer-panel-'+a+'"><h4 class="panel-title"><span class="title"><img src="/images/banners/Grid_Empty.png">Layer</span><button type="button" class="close"><span>&times;</span></button></h4></a></div><div class="panel-collapse collapse" id="layer-panel-'+a+'"><div class="panel-body"><div class="horizontal-scroll"><div class="color">'+n+'</div></div><div class="horizontal-scroll"><div class="banners text-center"></div></div></div></div></div>').appendTo("#banner-layers").data("layer",e),i=t.find(".banners"),l=this;return masks.forEach(function(e){var n=$('<a data-toggle="collapse" data-parent="#banner-layers">').addClass("banner").attr({title:lang[e].name,"data-type":e});l.previewBanner.overrideType(e).makeBanner(n),i.append(n)},this),this.previewBanner.overrideType(!1),$(".banner-container #banner-layers").sortable("destroy").sortable({items:":not(:first)",handle:".handle"}),t},addFirstBannerColorSelection:function(){var e=$(".banner-container #layer0 .banners");for(var n in colors){var r=$('<a data-toggle="collapse" data-parent="#banner-layers">').addClass("banner").attr({href:"#layer1",title:colors[n].name.replace("_"," ")}).data({type:"base",dye:n,color:colors[n].color});new Banner([{type:"base",color:colors[n].color,dye:n}]).makeBanner(r),r.append('<img src="/images/banners/Grid_'+n+'.png">'),e.append(r)}},setBaseDye:function(e){this.previewBanner.layers[0].dye=e,this.updateBanners()},updateLayersFromPanels:function(){this.previewBanner.layers=$(".banner-container #banner-layers .panel").toArray().map(function(e){return $(e).data("layer")}),this.updateBanners()},craftingTable:function(e,n,r){if(!e)return"";var a='<span class="item" title="'+n+'"><img src="/images/banners/Grid_'+n+'.png" width="32" height="32"></span>',t='<span class="item" title="Banner"><img src="/images/banners/Grid_'+colors[this.previewBanner.layers[0].dye].name+'_Banner.png" width="32" height="32"></span>',i='<span class="item" title="'+colors[n].name+'Wool"><img src="/images/banners/Grid_'+colors[n].name+'_Wool.png" width="32" height="32"></span>',l='<span class="item" title="Stick"><img src="/images/banners/Grid_Stick.png" width="32" height="32"></span>',o="string"==typeof e&&'<span class="item" title="'+e+'"><img src="/images/banners/'+e+'.png" width="32" height="32"></span>',s={dye:a,banner:t,wool:i,stick:l,shapeless:o};return o&&(e=[0,"dye",0,0,"shapeless",0,0,"banner",0]),'<a class="search" href="/gallery/tag/'+r+'"><table class="crafting-table" title="'+(o?"shapeless":"")+'">  <tr>    <td><span class="grid">'+(s[e[0]]||"")+'</span></td>    <td><span class="grid">'+(s[e[1]]||"")+'</span></td>    <td><span class="grid">'+(s[e[2]]||"")+'</span></td>  </tr>  <tr>    <td><span class="grid">'+(s[e[3]]||"")+'</span></td>    <td><span class="grid">'+(s[e[4]]||"")+'</span></td>    <td><span class="grid">'+(s[e[5]]||"")+'</span></td>  </tr>  <tr>    <td><span class="grid">'+(s[e[6]]||"")+'</span></td>    <td><span class="grid">'+(s[e[7]]||"")+'</span></td>    <td><span class="grid">'+(s[e[8]]||"")+"</span></td>  </tr></table></a>"},saveToGallery:function(e,n){var r=this,a=this.previewBanner.getResources();$(".banner-container #share-banner").button("loading"),ImageUtils.uploadImage(a.texture.toDataURL(),function(t){ImageUtils.uploadImage(a.screenshot.toDataURL(),function(a){$.post("/postToGallery",{url:t,screenshot:a,history:r.tags(),source:r.layerList(),title:e,caption:n,model:"Banner:recipe",texturemap:JSON.stringify(r.ntb())}).success(function(e){e&&$(".banner-container .gallerylink").attr("href","/skin/"+e).show()}).complete(function(){$(".banner-container #share-banner").button("reset")})},e,n)})}},preloadImages(),$(".banner-container #layer0 .banner").click(function(){bannereditor.setBaseDye($(this).data("dye"))}),$(".banner-container #banner-layers").on("click",".banner",function(e){var n=$(this).data("type"),r=$(this).data("dye"),a=$(this).parents(".panel:first").data("layer");a.type=n,r&&(a.dye=r),bannereditor.updateBanners(),e.preventDefault()}),$(".banner-container #banner-layers").on("mouseenter",".banner",function(e){var n=$(this).data("type"),r=$(this).data("dye"),a=$(this).parents(".panel:first").data("layer");a.overrideType=n,r&&(a.overrideColor=colors[r].color),bannereditor.updatePreview(),e.preventDefault()}).on("mouseleave",".banner",function(e){var n=$(this).parents(".panel:first").data("layer");delete n.overrideType,delete n.overrideColor,bannereditor.updatePreview(),e.preventDefault()}),$(document).on("click",".color div",function(e){var n=$(this).parents(".panel:first").data("layer"),r=$(this).data("dye");n.dye=r,bannereditor.updateBanners(),e.preventDefault()}).on("mouseenter",".color div",function(e){var n=$(this).parents(".panel:first"),r=n.data("layer"),a=$(this).css("background-color");r.overrideColor=a,bannereditor.updatePreview(),n.find(".banner div:last-child").css("background-color",a),e.preventDefault()}).on("mouseleave",".color div",function(e){var n=$(this).parents(".panel:first"),r=n.data("layer");delete r.overrideColor,bannereditor.updatePreview(),n.find(".banner div:last-child").css("background-color",colors[r.dye].color),e.preventDefault()}),$(".banner-container #banner-layers").on("mouseenter",".panel-heading .title",function(e){var n=$(this).parents(".panel:first").data("layer");new Banner([n]).makeBanner(".preview .banner"),e.preventDefault()}).on("mouseleave",".panel-heading .title",function(e){bannereditor.updatePreview(),e.preventDefault()}),$(".banner-container #add-layer").on("click",function(e){bannereditor.addLayerPanel().find(".panel-heading a").click(),e.preventDefault()}).tooltip(),$(".banner-container #banner-layers").on("sortupdate",function(){bannereditor.updateLayersFromPanels()}),$(".banner-container .explore").on("click",function(){exploreSimilar(bannereditor.previewBanner.layers)}),$(".banner-container .randomize").on("click",function(){$(".banner-container #random-banners .banners .banner").each(function(){for(var e=$(".banner-container #banners-toggle .active .banner").toArray().map(function(e){return $(e).data("type")}),n=$(".banner-container #colors-toggle .active").toArray().map(function(e){return $(e).data("dye")}),r=[n[Math.floor(Math.random()*n.length)],n[Math.floor(Math.random()*n.length)]],a=[],t=1+Math.ceil(6*Math.random()),i=0;i<t;i++){var l=r[Math.random()*r.length|0];a[i]={type:e[Math.random()*e.length|0],dye:l,color:colors[l].color}}a[0].type="base",new Banner(a).makeBanner(this),$(this).data("layers",a)})}),$(".banner-container #random-banners .banners").on("click",".banner",function(e){var n=$(this).data("layers");bannereditor.showLayers(n),exploreSimilar(n,this),e.preventDefault()}),$(".banner-container #banner-layers").on("click",".close",function(){$(this).parents(".editable-panel:first").remove(),bannereditor.updateLayersFromPanels()}),$(".banner-container #reset").click(function(){$(".banner-container .editable-panel").remove(),bannereditor.updateLayersFromPanels()}),$(".banner-container #save").on("click",function(e){var n=$.extend(!0,[],bannereditor.previewBanner.layers);showBannerOnCollection(n),storeCollection(),e.preventDefault()}),$(".banner-container #share-banner").click(function(){bannereditor.saveToGallery($(".banner-container #banner-name").val(),$(".banner-container #banner-description").val())}),$('.banner-container a[href="#share"]').click(function(){$(".banner-container .gallerylink").hide(),$(".banner-container #banner-name").val(""),$(".banner-container #banner-description").val("")}),$(".banner-container #collection").on("click",".close",function(){return $(this).parents(".banner:first").remove(),storeCollection(),!1}),$(".banner-container #collection").on("click",".banner",function(e){var n=$.extend(!0,[],$(this).data("layers"));bannereditor.showLayers(n),$('.banner-container a[href="#craft"]').click(),e.preventDefault()});var collection=localStorage.getItem("collection");collection&&JSON.parse(collection).forEach(showBannerOnCollection),masks.slice(1,masks.length).forEach(function(e){$('<label class="btn btn-default active"><div class="banner"/><input type="checkbox"></label>').appendTo("#banners-toggle").find(".banner").addClass("banner-"+e).css("background-image",'url("/images/banners/c/'+e+'.png")').data("type",e)});